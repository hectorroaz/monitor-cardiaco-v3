<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor de Frecuencia Cardíaca BLE v3.6.2 (Mod)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
        --c-z1: #2563eb; --c-z2: #059669; --c-z3: #fbbf24; --c-z4: #fb923c;
    }
    body { font-family: 'Inter', sans-serif; background: #000; color: #fff; }
    button { transition: background-color 0.3s, transform 0.1s; }
    button:active { transform: scale(0.98); }
    .btn-main { width: 100%; padding: 0.85em 0; border-radius: 1em; font-weight: 600; margin-top: 1em; }
    .zone-btns-row { display: flex; flex-direction: row; gap: 0.7em; justify-content: center; align-items: center; margin-bottom: 1.1em; flex-wrap: wrap; }
    .zone-btn { border-radius: 0.9em; padding: 0.39em 1.05em; font-size: 1.18rem; font-weight: 700; border: 2.5px solid #fff2; background: #23272f; color: #fff; transition: all 0.18s; cursor: pointer; outline: none; }
    .zone-btn.z1 { border-color: var(--c-z1); } .zone-btn.z2 { border-color: var(--c-z2); } .zone-btn.z3 { border-color: var(--c-z3); } .zone-btn.z4 { border-color: var(--c-z4); }
    .zone-btn.active.z1 { background: var(--c-z1); color: #fff; } .zone-btn.active.z2 { background: var(--c-z2); color: #fff; } .zone-btn.active.z3 { background: var(--c-z3); color: #1a1a1a; } .zone-btn.active.z4 { background: var(--c-z4); color: #fff; }
    .zone-desc { display: block; font-size: 1.09rem; text-align: center; margin-bottom: 1.1em; color: #e0e0e0; }
    @keyframes pulsate { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
    .heartbeat-animation { animation-name: pulsate; animation-duration: 1s; animation-iteration-count: infinite; animation-timing-function: ease-in-out; }
    .timer-box { font-family: 'Inter', monospace; font-size: 2.7rem; font-weight: 700; color: #06b6d4; margin-bottom: 1.2em; letter-spacing: 0.04em; }
    .controls-row { display: flex; flex-direction: row; gap: 1.4rem; justify-content: center; align-items: center; }
    .circle-btn { width: 3.3rem; height: 3.3rem; border-radius: 9999px; display: flex; align-items: center; justify-content: center; border: none; outline: none; cursor: pointer; position: relative; }
    .circle-btn svg { width: 2rem; height: 2rem; }
    .btn-play { background: #16a34a; } .btn-pause { background: #dc2626; } .btn-reset { background: #6b7280; }
    .btn-play:hover { background: #15803d; } .btn-pause:hover { background: #991b1b; } .btn-reset:hover { background: #334155; }
    .fullscreen-flex-vertical { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0; }
    .hr-container { width: 100vw; display: flex; justify-content: center; align-items: center; position: relative; }
    .controls-container { width: 100vw; display: flex; flex-direction: column; align-items: center; }
    .hr-size-proto { opacity: 0; position: absolute; left: 0; top: 0; pointer-events: none; user-select: none; z-index: -1; }
    #fullscreenHeartRateVisible { font-weight: 800; font-size: inherit; line-height: 1; text-align: center; word-break: break-all; white-space: nowrap; letter-spacing: -0.02em; margin: 0; padding: 0; overflow: hidden; display: block; z-index: 1; user-select: none; transition: color 0.2s; }
    .hr-blue { color: var(--c-z1) !important; } .hr-green { color: var(--c-z2) !important; } .hr-yellow { color: var(--c-z3) !important; } .hr-orange { color: var(--c-z4) !important; } .hr-red { color: #ef4444 !important; }
    .indicador-flecha { display: inline-flex; align-items: center; justify-content: center; margin-left: 2vw; font-size: 3rem; font-weight: 700; transition: all 0.18s; color: #f59e42; text-shadow: 0 2px 9px #0007; opacity: 1; min-width: 2.7rem; height: 2.7rem; user-select: none; }
    .indicador-flecha.arriba { color: #f87171; } .indicador-flecha.abajo { color: #60a5fa; } .indicador-flecha.ok { opacity: 0; transform: scale(0.5); }
    @media (orientation: landscape) {
      .fullscreen-flex-vertical {
        flex-direction: row;
        align-items: center; /* centro vertical los dos bloques */
        gap: 0;
        width: 100vw;
        height: 100vh;
      }
      .controls-container {
        width: 45vw;
        max-width: 450px;
        min-width: 220px;
        /* Quita height: 100vh; */
        justify-content: center;
        align-items: center;
        padding: 2vw 1vw 2vw 2vw;
        box-sizing: border-box;
        overflow-y: visible;
        display: flex;
        flex-direction: column;
      }
      .hr-container {
        width: 55vw;
        min-width: 200px;
        height: auto;
        justify-content: center;
        align-items: center;
        display: flex;
      }
      .zone-btns-row {
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.6em;
        margin-bottom: 1em;
      }
    }
    .result-msg { background: #18181b; color: #fafafa; border-radius: 1.2rem; padding: 1.1em 1.5em; font-size: 1.25rem; font-weight: 500; margin: 0.9em auto 0 auto; max-width: 95vw; box-shadow: 0 2px 16px #0006; border: 1.7px solid #444; text-align: center; }
    #fullscreenContainer { display: none !important; } #fullscreenContainer.active { display: flex !important; position: fixed; inset: 0; background: #000; z-index: 50; }
    /* Estilos para el Modal de Zonas */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 100; }
    .modal-overlay.active { display: flex; }
    .modal-content { background: #1e1e1e; padding: 2rem; border-radius: 1.5rem; border: 1px solid #444; width: 90vw; max-width: 500px; }
    .modal-content h2 { font-size: 1.8rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center; }
    .modal-input { background: #333; border: 1px solid #555; color: #fff; border-radius: 0.5em; padding: 0.5em 0.8em; width: 100%; }
    .modal-input:focus { outline: none; border-color: var(--c-z1); }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-md bg-black rounded-2xl shadow-lg p-8 space-y-6 text-center relative z-10">
    <header>
      <h1 class="text-3xl font-bold text-white">Monitor de Ritmo Cardíaco</h1>
      <div class="text-gray-400 mt-1 mb-4 text-sm">v 3.6.2</div>
      <p class="text-gray-400 mt-2 mb-2">Conéctate a tu banda de frecuencia cardíaca BLE.</p>
    </header>
    <div class="border border-gray-700 rounded-lg p-6 bg-gray-900">
      <div class="flex justify-center items-center mb-4">
        <svg id="heartIcon" class="w-16 h-16 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path></svg>
      </div>
      <div id="heartRateDisplay" class="text-7xl font-bold text-white tracking-tight">--</div>
      <div class="text-lg text-gray-400">BPM</div>
      <p id="bluetoothStatus" class="mt-4 text-sm text-gray-400 h-5">Estado: Desconectado</p>
    </div>
    <div class="grid grid-cols-2 gap-4">
        <button id="fullscreenBtn" class="btn-main bg-white text-black hover:bg-gray-100">Pantalla Completa</button>
        <button id="editZonesBtn" class="btn-main bg-gray-700 text-white hover:bg-gray-600">Editar Zonas</button>
    </div>
    <div>
        <button id="connectBluetooth" class="btn-main bg-blue-600 text-white hover:bg-blue-700 disabled:bg-gray-400">Conectar a Sensor</button>
    </div>
    <div id="resultMsg" class="result-msg" style="display:none;"></div>
  </div>

  <div id="fullscreenContainer">
    <div class="fullscreen-flex-vertical w-full h-full">
      <div class="controls-container">
        <div class="zone-btns-row" id="zoneBtnsRow"></div>
        <span id="zoneDesc" class="zone-desc"></span>
        <time id="sessionTime" class="timer-box">00:00:00</time>
        <div class="controls-row mt-2 mb-8">
          <button id="sessionPlayBtn" class="circle-btn btn-play" title="Iniciar" aria-label="Iniciar Sesión"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="10,8 16,12 10,16" fill="#fff"/></svg></button>
          <button id="sessionPauseBtn" class="circle-btn btn-pause" title="Pausar" aria-label="Pausar Sesión"><svg viewBox="0 0 24 24" fill="currentColor"><rect x="9" y="8" width="2" height="8" rx="1" fill="#fff"/><rect x="13" y="8" width="2" height="8" rx="1" fill="#fff"/></svg></button>
          <button id="resetSessionBtn" class="circle-btn btn-reset" title="Reiniciar" aria-label="Reiniciar Sesión"><svg viewBox="0 0 24 24" stroke="#fff" stroke-width="2" fill="none"><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="6"/></svg></button>
        </div>
        <button id="exitFullscreenBtn" class="mt-8 bg-gray-800 text-white px-10 py-5 rounded-xl text-2xl hover:bg-gray-900">Salir</button>
      </div>
      <div class="hr-container">
        <span id="fullscreenHeartRateProto" class="hr-size-proto">188</span>
        <span id="fullscreenHeartRateVisible">--</span>
        <span id="indicadorFlecha" class="indicador-flecha"></span>
      </div>
    </div>
  </div>

  <div id="zoneEditorModal" class="modal-overlay">
    <div class="modal-content space-y-4">
        <h2>Editar Zonas de Frecuencia</h2>
        <div class="grid grid-cols-3 gap-4 items-center">
            <label for="userAge" class="text-right font-semibold">Tu Edad:</label>
            <input type="number" id="userAge" class="modal-input col-span-1" placeholder="Ej: 30">
            <button id="calculateZonesBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Calcular</button>
        </div>
        <div id="zoneInputsContainer" class="space-y-3 pt-4"></div>
        <div class="flex justify-end space-x-4 pt-4">
            <button id="closeModalBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg">Cerrar</button>
            <button id="saveZonesBtn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-lg">Guardar</button>
        </div>
    </div>
  </div>

  <!-- (JS idéntico a la versión anterior; puedes copiar tu script aquí) -->
  <!-- ... -->
  <!-- No modifiqué nada en JS, solo en el CSS. Si quieres aquí va el script, avísame si lo necesitas. -->
  <!-- Puedes tomar el <script> exactamente igual que el que ya tienes. -->
</body>
</html>

